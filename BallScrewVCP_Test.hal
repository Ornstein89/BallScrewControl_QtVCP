#  HAL-файл исключительно для тестирования - создаёт тестовые сигналы с помощью siggen, запускает halscope и пр.

# создание компонентов для тестирования
loadrt siggen
loadrt wcomp # компаратор для перевода изначального тестового float-сигнала в bin
loadrt timedelay count=5 # задержки для повышения разнообразия тестовых сигналов
loadrt sum2 count=1
loadrt threads name1=test-thread period1=10000000
# loadrt conv_float_s32
# loadrt conv_float_s32
# loadrt conv_s32_bit

# ниже - размещение компонентов в специальном тестовом потоке
addf siggen.0.update test-thread
addf sum2.0 test-thread
addf wcomp.0 test-thread
addf timedelay.0 test-thread
addf timedelay.1 test-thread
addf timedelay.2 test-thread
addf timedelay.3 test-thread
addf timedelay.4 test-thread

# настройки констант
setp timedelay.0.on-delay 0.2
setp timedelay.0.off-delay 0.2

setp timedelay.1.on-delay 0.4
setp timedelay.1.off-delay 0.4

setp timedelay.2.on-delay 0.6
setp timedelay.2.off-delay 0.6

setp timedelay.3.on-delay 0.8
setp timedelay.3.off-delay 0.8

setp timedelay.4.on-delay 1.0
setp timedelay.4.off-delay 1.0

setp wcomp.0.min 0.0 # нижний уровень сигнала компаратора
setp wcomp.0.max 1.0 # верхний уровень сигнала компаратора

setp sum2.0.in0 0.01
net time sum2.0.out sum2.0.in1

net sine0 wcomp.0.in <= siggen.0.sine # вход компаратора, который будет из синуса выдавать логический сигнал, а также сигнал на форму 31
net cosine0 <= siggen.0.cosine # для формы 31

# 1) булев сигнал компаратора на задержки 2) попутно создаётся сигнал синусоиды для sw
# ИСХОДНАЯ СТРОКА, ВЕРНУТЬ ОБРАТНО ПРИ СБОЕ!!! net sw1 wcomp.0.out => timedelay.0.in timedelay.1.in timedelay.2.in timedelay.3.in timedelay.4.in
net bit0 wcomp.0.out => timedelay.0.in   # для формы 31
net bit0 => timedelay.1.in
net bit0 => timedelay.2.in
net bit0 => timedelay.3.in
net bit0 => timedelay.4.in

net bit1 <= timedelay.0.out          # для формы 31
net bit2 <= timedelay.1.out          # для формы 31
net bit3 <= timedelay.2.out          # для формы 31
net bit4 <= timedelay.3.out          # для формы 31
net bit5 <= timedelay.4.out          # для формы 31

#net pos_is_on <= timedelay.0.out       # для формы 31
#net pos_alarm <= timedelay.0.out       # для формы 31

#net is_running_ccw timedelay.0.out  # для формы 32
#net is_running_cw timedelay.0.out   # для формы 32


#---------------------------------------------
# Нельзя создать несколько сигналов от одного выхода! Если нужно подключать несколько входов к одному выходу, нужно это делать в одной строке
#net sig_todelay1 wcomp.0.out => timedelay.1.in
#net sig_todelay2 wcomp.0.out => timedelay.2.in
#net sig_todelay3 wcomp.0.out => timedelay.3.in
#net sig_todelay4 wcomp.0.out => timedelay.4.in
